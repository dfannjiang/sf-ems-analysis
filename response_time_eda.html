
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>911 Response Time Analysis &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'response_time_eda';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="SF EMS Analysis" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    SF EMS Analysis
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">911 Response Time Analysis</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/response_time_eda.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>911 Response Time Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">🚀 Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-insights">🔍 Key Insights</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recommendations">🔧 Recommendations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">📋 Table of contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jupyter-hide-input-true">jupyter:
hide-input: true</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-the-data">About the data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#high-level-analytics">High level analytics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-slow-response-times">Exploring slow response times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#breaking-down-response-times">Breaking down response times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dispatching-busy-ambulances">Dispatching busy ambulances</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-analysis-of-driving-times">Spatial analysis of driving times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#affect-of-hospital-diversions-on-response-times">Affect of hospital diversions on response times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Recommendations</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="response-time-analysis">
<h1>911 Response Time Analysis<a class="headerlink" href="#response-time-analysis" title="Link to this heading">#</a></h1>
<section id="motivation">
<h2>🚀 Motivation<a class="headerlink" href="#motivation" title="Link to this heading">#</a></h2>
<p>I want to understand how quickly the San Francisco Fire Department (FD) and Department of Emergency Management (DEM) respond medical 911 calls and see where improvements can be made to their response times.</p>
</section>
<section id="key-insights">
<h2>🔍 Key Insights<a class="headerlink" href="#key-insights" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>65% of life threatening calls are responded to within 10 minutes.</p></li>
<li><p>70% of non-life threaning calls are responded to within 20 minutes.</p></li>
<li><p>80% of the response time is FD units getting to the scene.</p></li>
<li><p>Outer regions of SF experience longer response times.</p></li>
</ul>
</section>
<section id="recommendations">
<h2>🔧 Recommendations<a class="headerlink" href="#recommendations" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Investigate factors that contribute to long driving times to the scene. Can ambulances be dispatched or allocated in more effective ways? And when they’re on the road, what are the biggest blockers to them getting to the scene?</p></li>
<li><p>Investigate what can be improved in how DEM works with FD to dispatch ambulances after receiving a call. What are the main roadblocks in this process?</p></li>
</ul>
</section>
<section id="table-of-contents">
<h2>📋 Table of contents<a class="headerlink" href="#table-of-contents" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#background"><span class="xref myst">Background</span></a></p></li>
<li><p><a class="reference internal" href="#about-the-data"><span class="xref myst">About the data</span></a></p></li>
<li><p><a class="reference internal" href="#high-level-analytics"><span class="xref myst">High level analytics</span></a></p></li>
<li><p><a class="reference internal" href="#exploring-slow-response-times"><span class="xref myst">Exploring slow response times</span></a></p></li>
<li><p><a class="reference internal" href="#breaking-down-response-times"><span class="xref myst">Breaking down response times</span></a></p></li>
<li><p><a class="reference internal" href="#dispatching-busy-ambulances"><span class="xref myst">Dispatching busy ambulances</span></a></p></li>
<li><p><a class="reference internal" href="#spatial-analysis-of-driving-times"><span class="xref myst">Spatial analysis of driving times</span></a></p></li>
<li><p><a class="reference internal" href="#affect-of-hospital-diversions-on-response-times"><span class="xref myst">Affect of hospital diversions on response times</span></a></p></li>
<li><p><a class="reference internal" href="#summary"><span class="xref myst">Summary</span></a></p></li>
</ol>
</section>
<hr class="docutils" />
<section id="jupyter-hide-input-true">
<h2>jupyter:
hide-input: true<a class="headerlink" href="#jupyter-hide-input-true" title="Link to this heading">#</a></h2>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p>The life cycle of a 911 call:</p>
<p><img alt="ambulance-response-process.png" src="_images/ambulance-response-process.png" /></p>
<p><em><a class="reference external" href="https://www.sf.gov/data/ambulance-response-life-threatening-emergencies">source</a></em></p>
<p>According to the <a class="reference external" href="https://www.sf.gov/sites/default/files/2023-12/FY23APRfinal.pdf">2023 SF Annual Performance report</a>, FD responds to 80-90% of 911 calls requiring an ambulance, and their goal is respond in under 10 minutes for code 3 calls (life-threatening) and under 20 minutes for code 2 calls (non-life-threatening). Their definition of their response time is the “Roll/Response” time (see above, <a class="reference external" href="https://www.sf.gov/data/ambulance-response-life-threatening-emergencies">source</a>), which is only a portion of the lifecycle of a 911 call. <strong>However, if I’m the caller, I ultimately care about the entire duration between initating the call and when an ambulance arrives - the “Call Duration” time</strong> (see above). In this project, I analyze DEM and FD’s performance using this metric, which I’ll call the “response time”.</p>
</section>
<section id="about-the-data">
<h2>About the data<a class="headerlink" href="#about-the-data" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="https://data.sfgov.org/Public-Safety/Fire-Department-and-Emergency-Medical-Services-Dis/nuek-vuh3/about_data">SFFD and EMS Dispatched Calls for Service</a> contains all the FD units that are dispatched for 911 calls for many years. In this analysis, I focus on the FD ambulances that get dispatched to life threatening (code 3) and non-life threatening (code 2) calls between January 2021 and August 2024.</p>
<p>To focus on high quality data, I also filter out data with the following characteristics:</p>
<ul class="simple">
<li><p>Missing latitude/longitude of the call</p></li>
<li><p>Dispatches without timestamps</p></li>
<li><p>Responses with negative response times</p></li>
<li><p>Responses where the response time is greater than 2 hours.</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">6</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;raw_data_analysis/08122024-5yr.parquet&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[(</span><span class="n">raw</span><span class="o">.</span><span class="n">call_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2021</span><span class="p">)]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">final_priority</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;on_scene_hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">on_scene_dttm</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;on_scene_day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">on_scene_dttm</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="k">def</span> <span class="nf">add_norm_lat_long</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">lats</span><span class="p">,</span> <span class="n">longs</span><span class="p">,</span> <span class="n">slats</span><span class="p">,</span> <span class="n">slongs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">case_location</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">coord</span> <span class="ow">and</span> <span class="s1">&#39;coordinates&#39;</span> <span class="ow">in</span> <span class="n">coord</span><span class="p">:</span>
            <span class="n">long</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">slongs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">long</span><span class="p">)</span>
            <span class="n">slats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
            <span class="n">longs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">long</span><span class="p">))</span>
            <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slongs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">slats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">longs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
            <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lats</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;long&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">longs</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;slat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slats</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;slong&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slongs</span>
    

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">long</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>

    <span class="n">lat_long_scalar</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">norm_lat_long</span> <span class="o">=</span> <span class="n">lat_long_scalar</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;long&#39;</span><span class="p">]])</span>
    <span class="n">norm_lat_long_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">norm_lat_long</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;norm_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;norm_long&#39;</span><span class="p">])</span>
    <span class="n">norm_lat_long_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
    <span class="n">df_normed_lat_long</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">norm_lat_long_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">lat_long_scalar</span><span class="p">,</span> <span class="n">df_normed_lat_long</span>

<span class="n">lat_long_scalar</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">add_norm_lat_long</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">long</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;received_to_dispatch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dispatch_dttm</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">received_dttm</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;dispatch_to_response&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">response_dttm</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">dispatch_dttm</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;response_to_onscene&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">on_scene_dttm</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">response_dttm</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;received_to_onscene&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">on_scene_dttm</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">received_dttm</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">received_to_dispatch</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dispatch_to_response</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">response_to_onscene</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="high-level-analytics">
<h2>High level analytics<a class="headerlink" href="#high-level-analytics" title="Link to this heading">#</a></h2>
<p>From Jan 2021 to Aug 2024, SFFD responded to 467,363 calls that needed an ambulance, or roughly 150-350 calls per day (see below). 66% (309,594) of these calls have a latitude/longitude and positive response times, so we’ll focus our analysis on these calls from now on.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[</span><span class="n">raw</span><span class="o">.</span><span class="n">unit_type</span> <span class="o">==</span> <span class="s1">&#39;MEDIC&#39;</span><span class="p">]</span>
<span class="n">tmp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;call_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">call_number</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<span class="n">title</span><span class="o">=</span><span class="s1">&#39;Calls per day requiring an ambulance&#39;</span><span class="p">,</span>
<span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Call date&#39;</span><span class="p">,</span>
<span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Call count&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/f5a45cbf392a3bf00409f808793817137abbec483d8ce813ae5be9818465440f.png" src="_images/f5a45cbf392a3bf00409f808793817137abbec483d8ce813ae5be9818465440f.png" />
</div>
</div>
<p>Below shows quantiles of response times for code 3 (life threatening) and code 2 (non-life threatening) calls. As you can see, SFFD and SFDEM response to code 2 calls much slower than code 3 calls. At least part of this is due to ambulances driving without lights and sirens for these calls (<a class="reference external" href="https://app.powerbigov.us/view?r=eyJrIjoiZWE0ZjE3OTEtYjE3Yi00YzJiLTgzOTEtOWU3ZGY2YzU4NTYwIiwidCI6IjIyZDVjMmNmLWNlM2UtNDQzZC05YTdmLWRmY2MwMjMxZjczZiJ9">source</a>).</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">unit_type</span> <span class="o">==</span> <span class="s1">&#39;MEDIC&#39;</span><span class="p">]</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tmp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;incident_number&#39;</span><span class="p">)[</span><span class="s1">&#39;dispatch_dttm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;received_to_onscene&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">],</span> <span class="n">showfliers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Retrieve the lines that make up the boxplot</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="c1"># Get the whiskers and box information</span>
    <span class="c1"># Lines are ordered as: whisker_min, whisker_max, box_min, median, box_max</span>
    <span class="n">whisker_low</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">whisker_high</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">median</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">q3</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Get the center position for the label</span>
    <span class="n">x_value</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Label each part with its value</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_value</span><span class="p">,</span> <span class="n">median</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Q2: </span><span class="si">{</span><span class="n">median</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_value</span><span class="p">,</span> <span class="n">q1</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Q1: </span><span class="si">{</span><span class="n">q1</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_value</span><span class="p">,</span> <span class="n">q3</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Q3: </span><span class="si">{</span><span class="n">q3</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_value</span><span class="p">,</span> <span class="n">whisker_low</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Q1-1.5IQR: </span><span class="si">{</span><span class="n">whisker_low</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_value</span><span class="p">,</span> <span class="n">whisker_high</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Q3+1.5IQR: </span><span class="si">{</span><span class="n">whisker_high</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>


<span class="c1"># Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Quantiles of response time: time until first ambulance arrival (minutes)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Minutes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/1501612927399602573bbdeae8146f99987c251007a9957725eb6bbefc707ddf.png" src="_images/1501612927399602573bbdeae8146f99987c251007a9957725eb6bbefc707ddf.png" />
</div>
</div>
</section>
<section id="exploring-slow-response-times">
<h2>Exploring slow response times<a class="headerlink" href="#exploring-slow-response-times" title="Link to this heading">#</a></h2>
<p>For this analysis, a call with a “slow” response time means that it took more than 10 minutes for the first ambulance to arrive on scene. As mentioned before, SFFD uses a similar metric by which to measure their response times. To ensure we’re looking at high quality data, we’ll also remove calls for which the response times is more than 2 hours, which is similar to how SF does their analysis (<a class="reference external" href="https://www.sf.gov/data/response-times-911-calls#ambulance-code-3-vehicle-response">source</a>). <strong>From now on, we’ll only consider calls with late responses</strong>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">tmp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">unit_type</span> <span class="o">==</span> <span class="s1">&#39;MEDIC&#39;</span><span class="p">]</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tmp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;incident_number&#39;</span><span class="p">)[</span><span class="s1">&#39;dispatch_dttm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()]</span>
<span class="n">medic</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[(</span><span class="n">tmp</span><span class="o">.</span><span class="n">received_to_onscene</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">received_to_onscene</span> <span class="o">&lt;</span> <span class="mi">120</span><span class="p">)]</span>
<span class="n">medic</span><span class="o">.</span><span class="n">unit_id</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">medic</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="n">tmp</span><span class="o">.</span><span class="n">received_to_onscene</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">])],</span> <span class="n">colors</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;Dark2&#39;</span><span class="p">),</span>
        <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Late&#39;</span><span class="p">,</span> <span class="s1">&#39;On Time&#39;</span><span class="p">]);</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Calls broken down by their response times&#39;</span><span class="p">);</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">medic</span><span class="p">[</span><span class="n">medic</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">medic</span><span class="p">[</span><span class="n">medic</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">])],</span>
        <span class="n">colors</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;tab10&#39;</span><span class="p">),</span>
        <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.0f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Code 2 (non-life threatening)&#39;</span><span class="p">,</span> <span class="s1">&#39;Code 3 (life threatening)&#39;</span><span class="p">]);</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Among calls with late responses, breakdown of code 3 and code 2 calls.&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/2503600ebe619597812ed31b93483b627e81b9c0ad5df64a5d9ea580bab711d2.png" src="_images/2503600ebe619597812ed31b93483b627e81b9c0ad5df64a5d9ea580bab711d2.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;received_hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">received_dttm</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
<span class="n">medic</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;received_hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">medic</span><span class="o">.</span><span class="n">received_dttm</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;received_day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">received_dttm</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
<span class="n">medic</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;received_day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">medic</span><span class="o">.</span><span class="n">received_dttm</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
</div>
</div>
<p>As we can see below, there is a strong association between response times and volume of calls in that time period: Avg response times peak on friday when most calls during the week happen, and particularly between 10am and 6pm when most calls during a day happen.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">medic_onscene_day</span> <span class="o">=</span> <span class="n">medic</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;received_day_of_week&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">received_to_onscene</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;call_number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">received_day_of_week</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_call_count</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;received_day_of_week&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># Plot the first line plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;received_day_of_week&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;received_to_onscene&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">medic_onscene_day</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean response duration&#39;</span><span class="p">)</span>

<span class="c1"># Create a second y-axis with twinx</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

<span class="c1"># Plot the second line plot on the second y-axis</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;received_day_of_week&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_call_count</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;# calls received&#39;</span><span class="p">)</span>

<span class="n">lines_1</span><span class="p">,</span> <span class="n">labels_1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">lines_2</span><span class="p">,</span> <span class="n">labels_2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines_1</span> <span class="o">+</span> <span class="n">lines_2</span><span class="p">,</span> <span class="n">labels_1</span> <span class="o">+</span> <span class="n">labels_2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<span class="c1"># Add labels for both y-axes</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ambulance response duration (min)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# calls received&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Day of week&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;unused&#39;</span><span class="p">,</span><span class="s1">&#39;Monday&#39;</span><span class="p">,</span> <span class="s1">&#39;Tuesday&#39;</span><span class="p">,</span> <span class="s1">&#39;Wednesday&#39;</span><span class="p">,</span> <span class="s1">&#39;Thursday&#39;</span><span class="p">,</span> <span class="s1">&#39;Friday&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturday&#39;</span><span class="p">,</span> <span class="s1">&#39;Sunday&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Calls received and response times by day of week&#39;</span><span class="p">)</span>
<span class="c1"># Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/907d94dd5662d350880c4e74e3f47fa4ede5d525b1ddacfd5175764de6d10c57.png" src="_images/907d94dd5662d350880c4e74e3f47fa4ede5d525b1ddacfd5175764de6d10c57.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">medic_onscene_hr</span> <span class="o">=</span> <span class="n">medic</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;received_hour&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">received_to_onscene</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;call_number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">received_hour</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_call_count</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;received_hour&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># Plot the first line plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;received_hour&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;received_to_onscene&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">medic_onscene_hr</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean response duration&#39;</span><span class="p">)</span>

<span class="c1"># Create a second y-axis with twinx</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

<span class="c1"># Plot the second line plot on the second y-axis</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;received_hour&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_call_count</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;# calls received&#39;</span><span class="p">)</span>

<span class="n">lines_1</span><span class="p">,</span> <span class="n">labels_1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">lines_2</span><span class="p">,</span> <span class="n">labels_2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines_1</span> <span class="o">+</span> <span class="n">lines_2</span><span class="p">,</span> <span class="n">labels_1</span> <span class="o">+</span> <span class="n">labels_2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<span class="c1"># Add labels for both y-axes</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Ambulance response duration (min)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# calls received&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Hour that call was received&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Calls received and response times by hour of day&#39;</span><span class="p">)</span>
<span class="c1"># Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/a9618a738a4ad4d8ba46b1a06dd458c0e54ff9fb127fbacbd66f34bf5e0ecaa2.png" src="_images/a9618a738a4ad4d8ba46b1a06dd458c0e54ff9fb127fbacbd66f34bf5e0ecaa2.png" />
</div>
</div>
<p>Additionally, the response time is very left skewed, so in general we will log transform the total response time in the visualizations</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fix</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">medic</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;received_to_onscene&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">);</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Response time&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">medic</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;received_to_onscene&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">log_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">);</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;log(response time)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/2a15d5dbb49518eb64eccb9a1cdc554da8c2e3f98fb62abd0dc27473fa4280d2.png" src="_images/2a15d5dbb49518eb64eccb9a1cdc554da8c2e3f98fb62abd0dc27473fa4280d2.png" />
</div>
</div>
</section>
<section id="breaking-down-response-times">
<h2>Breaking down response times<a class="headerlink" href="#breaking-down-response-times" title="Link to this heading">#</a></h2>
<p>In the data, we have the following timestamps:
<img alt="response-time-breakdown.png" src="_images/response-time-breakdown.png" />
Let’s visualize which stages take up the biggest portions of the total response time and how they’re correlated with the total response time.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">medic</span><span class="p">[</span><span class="s1">&#39;received_to_dispatch_perc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">medic</span><span class="o">.</span><span class="n">received_to_dispatch</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">medic</span><span class="o">.</span><span class="n">received_to_onscene</span>
<span class="n">medic</span><span class="p">[</span><span class="s1">&#39;dispatch_to_response_perc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">medic</span><span class="o">.</span><span class="n">dispatch_to_response</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">medic</span><span class="o">.</span><span class="n">received_to_onscene</span>
<span class="n">medic</span><span class="p">[</span><span class="s1">&#39;response_to_onscene_perc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">medic</span><span class="o">.</span><span class="n">response_to_onscene</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">medic</span><span class="o">.</span><span class="n">received_to_onscene</span>
<span class="n">medic</span><span class="p">[</span><span class="s1">&#39;received_to_dispatch_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">medic</span><span class="o">.</span><span class="n">received_to_dispatch</span><span class="p">)</span>
<span class="n">medic</span><span class="p">[</span><span class="s1">&#39;dispatch_to_response_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">medic</span><span class="o">.</span><span class="n">dispatch_to_response</span><span class="p">)</span>
<span class="n">medic</span><span class="p">[</span><span class="s1">&#39;response_to_onscene_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">medic</span><span class="o">.</span><span class="n">response_to_onscene</span><span class="p">)</span>
<span class="n">medic</span><span class="p">[</span><span class="s1">&#39;received_to_onscene_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">medic</span><span class="o">.</span><span class="n">received_to_onscene</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">medic</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">x</span><span class="o">=</span><span class="s1">&#39;received_to_dispatch_perc&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;received_to_onscene_log&#39;</span><span class="p">,</span>
           <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;kde&quot;</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">% d</span><span class="s2">uration(received -&gt; dispatch) vs log(response time)&quot;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">uration(received -&gt; dispatch)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;log (response time)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/58f15d23abf4e0201a2e8e679d3eadd9507c15a51e108e387c0230518bc23842.png" src="_images/58f15d23abf4e0201a2e8e679d3eadd9507c15a51e108e387c0230518bc23842.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">medic</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">x</span><span class="o">=</span><span class="s1">&#39;dispatch_to_response_perc&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;received_to_onscene_log&#39;</span><span class="p">,</span>
           <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">]);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">% d</span><span class="s2">uration(dispatch -&gt; response) vs log(response time)&quot;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">uration(dispatch -&gt; response)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;log (response time)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/caef778469f8a7bb1085942e40e495e554f982036b2d7b04c804d32372a18e05.png" src="_images/caef778469f8a7bb1085942e40e495e554f982036b2d7b04c804d32372a18e05.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">medic</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">x</span><span class="o">=</span><span class="s1">&#39;response_to_onscene_perc&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;received_to_onscene_log&#39;</span><span class="p">,</span>
           <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">]);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">% d</span><span class="s2">uration(response -&gt; on scene) vs log(response time)&quot;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">uration(response -&gt; onscene)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;log (response time)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/2b99fdb46cbd57d90a2cdd5c556bbeb2ca1468937a4b0611732eb8093ff259e3.png" src="_images/2b99fdb46cbd57d90a2cdd5c556bbeb2ca1468937a4b0611732eb8093ff259e3.png" />
</div>
</div>
<p><strong>Conclusion</strong>: On average, 20% of the response time is spent receiving the call and dispatching an ambulance, and 80% is spent getting to the scene after acknowledging the dispatch. The time it takes for the ambulance to acknowledge the dispatch is negligible. There seems to be some correlation between these proportions and the total response time, especially for code 2 calls.</p>
</section>
<section id="dispatching-busy-ambulances">
<h2>Dispatching busy ambulances<a class="headerlink" href="#dispatching-busy-ambulances" title="Link to this heading">#</a></h2>
<p>For 8% of calls of slow repsonse times, the ambulance that was dispatched was not yet available when SFDEM received the call. Let’s see this impact on the time it takes to dispatch an ambulance:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">medic_sorted</span> <span class="o">=</span> <span class="n">medic</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;received_dttm&#39;</span><span class="p">)</span>
<span class="n">medic_sorted</span><span class="p">[</span><span class="s1">&#39;prev_avail&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">unit_id</span> <span class="ow">in</span> <span class="n">medic_sorted</span><span class="o">.</span><span class="n">unit_id</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">unit_filter</span> <span class="o">=</span> <span class="n">medic_sorted</span><span class="o">.</span><span class="n">unit_id</span> <span class="o">==</span> <span class="n">unit_id</span>
    <span class="n">index_to_set</span> <span class="o">=</span> <span class="n">medic_sorted</span><span class="p">[</span><span class="n">unit_filter</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">prev_avail</span> <span class="o">=</span> <span class="n">medic_sorted</span><span class="p">[</span><span class="n">unit_filter</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">available_dttm</span>
    <span class="n">prev_avail</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index_to_set</span>
    <span class="n">medic_sorted</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">unit_filter</span><span class="p">,</span> <span class="s1">&#39;prev_avail&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_avail</span>
<span class="n">medic_sorted</span><span class="o">.</span><span class="n">prev_avail</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">medic_sorted</span><span class="o">.</span><span class="n">prev_avail</span><span class="p">)</span>
<span class="n">medic_sorted</span><span class="p">[</span><span class="s1">&#39;prev_rest_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">medic_sorted</span><span class="o">.</span><span class="n">received_dttm</span> <span class="o">-</span> <span class="n">medic_sorted</span><span class="o">.</span><span class="n">prev_avail</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">sum</span><span class="p">(</span><span class="n">medic_sorted</span><span class="o">.</span><span class="n">prev_rest_min</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">medic_sorted</span><span class="p">)</span>
<span class="n">medic_sorted</span><span class="p">[</span><span class="s1">&#39;avail_when_received&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">medic_sorted</span><span class="o">.</span><span class="n">prev_rest_min</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">medic_sorted</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;received_to_dispatch_perc&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;avail_when_received&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">% d</span><span class="s2">uration(received -&gt; dispatch) for busy and available ambulances&quot;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">uration(received -&gt; dispatch)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/4b47072ca769164c49365fa9066f92f96e1fa08ba7cc2585da8d879034863985.png" src="_images/4b47072ca769164c49365fa9066f92f96e1fa08ba7cc2585da8d879034863985.png" />
</div>
</div>
<p><strong>Conclusion</strong>: If an ambulance is not available by the time its next call is received, the % of that next call’s response time taken up by simply dispatching the ambulance increases by 50% on average.</p>
</section>
<section id="spatial-analysis-of-driving-times">
<h2>Spatial analysis of driving times<a class="headerlink" href="#spatial-analysis-of-driving-times" title="Link to this heading">#</a></h2>
<p><img alt="driving-time-breakdown.png" src="_images/driving-time-breakdown.png" /></p>
<p>Let’s see if the duration of an ambulance responding to the scene are significantly different for different areas of SF. This may not entirely be due to driving, but I will call it “driving time” for simplicity. To split SF into different regions, I define 50 geographic regions using K-Means on the call locations. 50 was chosen because there are roughly that number of fire stations in SF, but the number itself is not important. Next, I display the top 15 clusters with the longest average response times (along with fire stations in green):</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dedup_calls</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="n">data</span>
    
    <span class="n">filtered</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;slong&#39;</span><span class="p">,</span> <span class="s1">&#39;slat&#39;</span><span class="p">])</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">filtered</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;slong&#39;</span><span class="p">,</span> <span class="s1">&#39;slat&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
        <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
        <span class="s1">&#39;long&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;norm_lat&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">],</span>
    <span class="s1">&#39;norm_long&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
        <span class="s1">&#39;received_to_onscene&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span>
    <span class="p">})</span>
    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;norm_lat mean&#39;</span><span class="p">:</span> <span class="s1">&#39;norm_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;norm_lat count&#39;</span><span class="p">:</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;norm_long mean&#39;</span><span class="p">:</span> <span class="s1">&#39;norm_long&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;lat mean&#39;</span><span class="p">:</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;long mean&#39;</span><span class="p">:</span> <span class="s1">&#39;long&#39;</span><span class="p">,</span> <span class="s1">&#39;received_to_onscene mean&#39;</span><span class="p">:</span> <span class="s1">&#39;received_to_onscene&#39;</span><span class="p">})</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;received_to_onscene&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">cluster</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">dedup_calls</span><span class="p">(</span><span class="n">medic_sorted</span><span class="p">)</span>
<span class="n">km</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">km</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="s1">&#39;norm_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;norm_long&#39;</span><span class="p">]],</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">)</span>
<span class="n">preds</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">preds</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;norm_long&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;norm_lat&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;hls&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">));</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">();</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;50 geographic regions created by K-Means&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/8b8ee11e4165d301daec8cc13a2e1eb360db5460f6eba0d6f7ce9fd4cfd2738e.png" src="_images/8b8ee11e4165d301daec8cc13a2e1eb360db5460f6eba0d6f7ce9fd4cfd2738e.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">medic_sorted_clustered</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">medic_sorted</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;slong&#39;</span><span class="p">,</span> <span class="s1">&#39;slat&#39;</span><span class="p">])</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">medic_sorted</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">medic_sorted_clustered</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">medic_sorted</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">medic_sorted_clustered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="n">nhoods</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;raw_data_analysis/Analysis Neighborhoods.geojson&#39;</span><span class="p">)</span>
<span class="n">stations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;raw_data_analysis/stations.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_clusters</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">condition</span><span class="p">]</span>
    <span class="n">cluster_metrics</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;cluster&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">response_to_onscene</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> 
    <span class="n">ordered_clusters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cluster_metrics</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">nhoods</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ordered_clusters</span><span class="p">[</span><span class="o">-</span><span class="mi">15</span><span class="p">:])]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;long&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">stations</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;long&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">122.52</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.32</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">37.7088</span><span class="p">,</span> <span class="mf">37.85</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">show_clusters</span><span class="p">(</span><span class="n">medic_sorted_clustered</span><span class="p">,</span> <span class="n">medic_sorted_clustered</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Code 3 calls: areas with worst driving times&#39;</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">show_clusters</span><span class="p">(</span><span class="n">medic_sorted_clustered</span><span class="p">,</span> <span class="n">medic_sorted_clustered</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Code 2 calls: areas with worst driving times&#39;</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/903f5a58df9acdc563eb71c1367566bbb67f674d0203fca0bd907ec1c9d1c893.png" src="_images/903f5a58df9acdc563eb71c1367566bbb67f674d0203fca0bd907ec1c9d1c893.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">permutation_test</span>

<span class="k">def</span> <span class="nf">run_permutation_test</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">condition</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">condition</span><span class="p">]</span>
    <span class="n">cluster_metrics</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;cluster&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">response_to_onscene</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> 
    <span class="n">ordered_clusters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cluster_metrics</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>    
    
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;worst_clusters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ordered_clusters</span><span class="p">[</span><span class="o">-</span><span class="mi">15</span><span class="p">:])</span>
    <span class="n">sampled</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">group1</span> <span class="o">=</span> <span class="n">sampled</span><span class="p">[</span><span class="n">sampled</span><span class="o">.</span><span class="n">worst_clusters</span><span class="p">]</span><span class="o">.</span><span class="n">response_to_onscene</span>
    <span class="n">group2</span> <span class="o">=</span> <span class="n">sampled</span><span class="p">[</span><span class="o">~</span><span class="n">sampled</span><span class="o">.</span><span class="n">worst_clusters</span><span class="p">]</span><span class="o">.</span><span class="n">response_to_onscene</span>

    <span class="c1"># Run the permutation test</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">permutation_test</span><span class="p">((</span><span class="n">group1</span><span class="p">,</span> <span class="n">group2</span><span class="p">),</span> 
                              <span class="n">statistic</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> 
                              <span class="n">n_resamples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>  <span class="c1"># Monte Carlo approximation with 10,000 resamples</span>
                              <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;greater&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;p-value: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">pvalue</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Code 2 calls: permutation test for difference in mean driving time between worst areas vs others:&#39;</span><span class="p">)</span>
<span class="n">run_permutation_test</span><span class="p">(</span><span class="n">medic_sorted_clustered</span><span class="p">,</span> <span class="n">medic_sorted_clustered</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Code 3 calls: permutation test for difference in mean driving time between worst areas vs others:&#39;</span><span class="p">)</span>
<span class="n">run_permutation_test</span><span class="p">(</span><span class="n">medic_sorted_clustered</span><span class="p">,</span> <span class="n">medic_sorted_clustered</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Code 2 calls: permutation test for difference in mean driving time between worst areas vs others:
p-value: 9.999000099990002e-05

Code 3 calls: permutation test for difference in mean driving time between worst areas vs others:
p-value: 9.999000099990002e-05
</pre></div>
</div>
</div>
</div>
<p><strong>Conclusion</strong>: the areas with the worse driving times are all on the outskirts of the city (everywhere outside of the enclosed black lines is the Pacific Ocean / SF bay), which are also the areas with lower population density, lower volume of 911 calls, and lower density of fire stations.</p>
<p>A couple of notes:</p>
<ol class="arabic simple">
<li><p>I used a permutation test to test if the difference in means is significant in order to avoid making parametric assumptions in my data, which are not normally distributed.</p></li>
<li><p>In this analysis, I did not weight driving times by the population or amount of calls in a given geographic area. In my perspective, this is one way to promote equity; SF’s EMS system should be</p></li>
</ol>
</section>
<section id="affect-of-hospital-diversions-on-response-times">
<h2>Affect of hospital diversions on response times<a class="headerlink" href="#affect-of-hospital-diversions-on-response-times" title="Link to this heading">#</a></h2>
<p>Hospitals can declare “ambulance diversion status”, which prevents more ambulances arriving to that hospital (except for specialty cases). This <a class="reference external" href="https://data.sfgov.org/Health-and-Social-Services/Hospital-Diversions/t4sf-777q/about_data">dataset</a> contains all declarations of diversion status since 2023. Let’s see if hospital diversions affect subsequent call response times due to slowing down ambulances that need to transport patients to a hospital. To run this analysis, I do the following:</p>
<ol class="arabic simple">
<li><p>Get the number of hospitals on diversion status for each 30 min interval for which we have data (Jan 2023 - Aug 2024)</p></li>
<li><p>For each call, record the number of hospital diversions there were when the call was received (the current period) and 30 minutes before the call was received (the previous period).</p></li>
</ol>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diversions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;raw_data_analysis/hospital_diversions.parquet&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diversions</span><span class="o">.</span><span class="n">duration_in_minutes</span> <span class="o">=</span> <span class="n">diversions</span><span class="o">.</span><span class="n">duration_in_minutes</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">diversions</span><span class="o">.</span><span class="n">duration_in_minutes</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                         <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Histogram of hospital diversion durations (min)&#39;</span><span class="p">,</span>
                                        <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Minutes&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/7b725d410474193e8d0bec13d280f81a64840f9818d5b744d826596936fa34eb.png" src="_images/7b725d410474193e8d0bec13d280f81a64840f9818d5b744d826596936fa34eb.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the range of hours you want to analyze</span>
<span class="n">all_periods</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">diversions</span><span class="p">[</span><span class="s1">&#39;started&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s1">&#39;30T&#39;</span><span class="p">),</span> 
                          <span class="n">end</span><span class="o">=</span><span class="n">diversions</span><span class="p">[</span><span class="s1">&#39;ended&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="s1">&#39;30T&#39;</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;30T&#39;</span><span class="p">)</span>

<span class="c1"># Create a DataFrame to store the number of hospitals in diversion each hour</span>
<span class="n">diversion_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;period&#39;</span><span class="p">:</span> <span class="n">all_periods</span><span class="p">})</span>

<span class="c1"># For each hour, count the number of hospitals that are in diversion</span>
<span class="n">diversion_counts</span><span class="p">[</span><span class="s1">&#39;diversion_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">diversion_counts</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">h</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">diversions</span><span class="p">[</span><span class="s1">&#39;started&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">h</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">diversions</span><span class="p">[</span><span class="s1">&#39;ended&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">h</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">medic_sorted</span><span class="p">[</span><span class="s1">&#39;received_30T&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">medic_sorted</span><span class="o">.</span><span class="n">received_dttm</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s1">&#39;30min&#39;</span><span class="p">)</span>
<span class="n">medic_sorted</span><span class="p">[</span><span class="s1">&#39;received_30T_prev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">medic_sorted</span><span class="o">.</span><span class="n">received_30T</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">medic_sorted_with_diversions</span> <span class="o">=</span> <span class="n">medic_sorted</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">diversion_counts</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span>
                                        <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;received_30T&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;period&#39;</span><span class="p">)</span>
<span class="n">medic_sorted_with_diversions</span> <span class="o">=</span> <span class="n">medic_sorted_with_diversions</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">diversion_counts</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span>
                                        <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;received_30T_prev&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;period&#39;</span><span class="p">,</span>
                                        <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_curr&#39;</span><span class="p">,</span> <span class="s1">&#39;_prev&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">medic_sorted_with_diversions</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;diversion_count_curr&#39;</span><span class="p">,</span>
             <span class="n">y</span><span class="o">=</span><span class="s1">&#39;received_to_onscene_log&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Diversions in current period vs log(response time)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;# diversions&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;log(response time)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/91774ea0a1efc64e1ae4e53a58f442927f44c795a7a5745646654387d5f2cf00.png" src="_images/91774ea0a1efc64e1ae4e53a58f442927f44c795a7a5745646654387d5f2cf00.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">medic_sorted_with_diversions</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;diversion_count_prev&#39;</span><span class="p">,</span>
             <span class="n">y</span><span class="o">=</span><span class="s1">&#39;received_to_onscene_log&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Diversions in previous period vs log(response time)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;# diversions&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;log(response time)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/451f2810b0b78ad6e0b98bcc5b66022e2f074f4a5b4f5fc36a2f5e22e8bd6167.png" src="_images/451f2810b0b78ad6e0b98bcc5b66022e2f074f4a5b4f5fc36a2f5e22e8bd6167.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">medic_sorted_with_diversions</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;diversion_count_curr&#39;</span><span class="p">,</span>
             <span class="n">y</span><span class="o">=</span><span class="s1">&#39;received_to_dispatch_perc&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Diversions in current period vs </span><span class="si">% d</span><span class="s1">uration(received -&gt; dispatch)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;# diversions&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">uration(received -&gt; dispatch)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/cbf0ca0c1617b741b15ad838df76993fe616a8c8ea08f6914157bd5bd4fb15b9.png" src="_images/cbf0ca0c1617b741b15ad838df76993fe616a8c8ea08f6914157bd5bd4fb15b9.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">medic_sorted_with_diversions</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;diversion_count_prev&#39;</span><span class="p">,</span>
             <span class="n">y</span><span class="o">=</span><span class="s1">&#39;received_to_dispatch_perc&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Diversions in previous period vs </span><span class="si">% d</span><span class="s1">uration(received -&gt; dispatch)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;# diversions&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% d</span><span class="s1">uration(received -&gt; dispatch)&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/4364ad043752fefed44fac61939b753f522cb304afec2d3e3422cb21422f038d.png" src="_images/4364ad043752fefed44fac61939b753f522cb304afec2d3e3422cb21422f038d.png" />
</div>
</div>
<p><strong>Conclusion</strong>: There doesn’t seem to be evidence that hospital diversions affect subsequent call response times. Perhaps this is due to the number of hospitals in SF in general, meaning that even if 1 or more hospitals are on diversion status, there are still enough hospitals for ambulances to transport their patients to.</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>56% of calls between Jan 2021 and Aug 2024 had a response time greater than 10 minutes. This response times varies across geographic regions and is particularly worse in the outer regions of SF. Response times are also fairly correlated with 911 call arrival rates, which are highest between roughly 10am and 6pm. On average, the first 20% of a response to a call is comprised of SFDEM receiving the call and dispatching a unit, and the other 80% is the SFFD ambulance getting to the scene after being dispatched by SFDEM.</p>
<section id="id1">
<h3>Recommendations<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>For only 8% of calls with slow responses, ambulances are dispatched before they are available. That means for the other 92%, the duration of the response time seems to be from SFDEM processing the call and dispatching a unit and the SFFD ambulance getting to the scene after being dispatched. Therefore, I’d recommend investigating the following:</p>
<ul class="simple">
<li><p>How SFDEM triages calls and decides whether to send an ambulance. Are there processes or technologies that could make this process more efficient?</p></li>
<li><p>Can communication between SFDEM and SFFD and other ambulance providers be streamlines in order to dispatch ambulances faster?</p></li>
<li><p>Do ambulances encounter issues on the road that slow them down while en route to the scene?</p></li>
<li><p>Is the best choice being made when deciding on a particular ambulance to dispatch to a call?</p></li>
<li><p>Could ambulances be stationed at more optimal places throughout the day in order to be closer to incoming calls?</p></li>
</ul>
<p>I’ll be exploring solutions to the last point by building a simulation of 911 medical calls and using reinforcement learning. Stay tuned!</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">SF EMS Analysis</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">🚀 Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-insights">🔍 Key Insights</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recommendations">🔧 Recommendations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">📋 Table of contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jupyter-hide-input-true">jupyter:
hide-input: true</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-the-data">About the data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#high-level-analytics">High level analytics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-slow-response-times">Exploring slow response times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#breaking-down-response-times">Breaking down response times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dispatching-busy-ambulances">Dispatching busy ambulances</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-analysis-of-driving-times">Spatial analysis of driving times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#affect-of-hospital-diversions-on-response-times">Affect of hospital diversions on response times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Recommendations</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>